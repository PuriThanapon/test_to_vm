<!-- Autogenerated guidance for AI coding agents working on this repo -->
# Copilot / AI agent instructions — frontend (Next.js)

Summary
- This repo contains a Next.js 16 application in `frontend/` using the App Router (`app/`) with server components and server actions. The frontend talks to a Strapi backend (see `backend/`) via `process.env.STRAPI_BASE_URL`. The project is containerized with a `Dockerfile` (Next `output: 'standalone'`) and `docker-compose.yml` at the repo root.

Big picture (what matters)
- Frontend: `frontend/` — Next.js app (App Router). Key folders: `app/`, `components/`, `lib/`, `hooks/`, `public/`.
- Backend: `backend/` — Strapi-style API expected; configured via `STRAPI_BASE_URL` env var.
- Auth flow: middleware (`frontend/middleware.js`) protects `/main-menu/:path*` by reading `token` cookie and calling `${STRAPI_BASE_URL}/api/users/me`. Middleware sets a `users` header with a small JSON payload for downstream pages.
- Build/runtime: `next.config.ts` sets `output: 'standalone'`. The `Dockerfile` relies on Next's standalone build and runs the generated `server.js`.

Important files to read (examples)
- `package.json` — scripts: `dev`, `build`, `start`, `lint` (use these for local commands).
- `next.config.ts` — `output: 'standalone'` (Dockerfile assumes standalone output).
- `Dockerfile` — multi-stage build; copies `.next/standalone` and `.next/static` and runs `node server.js`.
- `middleware.js` — auth middleware (cookie check + fetch to Strapi). Example: it uses `request.cookies.get('token')` and `NextResponse.redirect`.
- `app/auth/signin/action-signin.ts` — server action that calls Strapi auth and sets `token` via `cookies()`; note the explicit pattern: return an object describing success/error instead of throwing — follow this pattern.
- `components/ui/*` — UI primitives use `class-variance-authority` (`cva`) + `cn` helper in `lib/utils.ts`.

Project-specific conventions and rules
- Server actions: Use `"use server"` for actions that run on the server. Prefer returning structured result objects (e.g. `{ success: boolean, message: string }`) on error rather than throwing; signinAction explicitly returns error objects and logs server-side details instead of throwing.
- Cookie handling: auth token is stored in an httpOnly cookie named `token`. When setting cookies, follow the existing options: `httpOnly: true`, `sameSite: 'lax'`, `secure: process.env.NODE_ENV === 'production'`, `path: '/'`.
- Middleware expectations: middleware adds a header `users` containing JSON — downstream code reads headers (middleware is used to pass minimal user info to pages).
- UI components: follow the CVA pattern (variants + sizes) and export both component and variants (e.g. `export { Button, buttonVariants }`). Use `cn()` from `lib/utils.ts` to merge Tailwind classes.
- Error handling: many server-side calls convert errors to user-facing messages and return them; do not change that contract without updating callers.

Dev / build workflows (how to run)
- Local dev (frontend):
  - `npm run dev` (or `yarn dev`, `pnpm dev`) — runs Next dev server on `localhost:3000`.
  - `npm run build` then `npm run start` — build and start the production server (or use Docker).
- Docker / compose:
  - Build and run both services: `docker-compose up --build` (or `docker compose up --build`).
  - The `frontend` service exposes port `3000` (see `docker-compose.yml`).

Environment and integrations
- Required env var for local/dev: `STRAPI_BASE_URL` pointing to backend API (used by `action-signin.ts` and `middleware.js`).
- The app uses Next 16, React 19, Node 20, Tailwind v4, Radix UI primitives, Sonner for toasts. Be mindful of package versions in `package.json` when editing or upgrading.

What to change carefully (gotchas)
- Changing the build output mode in `next.config.ts` (e.g. removing `standalone`) requires updating `Dockerfile` — the current Dockerfile expects the standalone output and `server.js` to exist.
- Do not change the server action error contract (return object vs throw) without updating client code that reads the returned result.
- Avoid exposing tokens in client logs — token is stored httpOnly in cookies; any debugging that needs the token should be server-side only.

Where to look for patterns
- Auth: `app/auth/*` and `middleware.js` (signin flow + cookies).
- UI primitives: `components/ui/*` (button, input, card, tooltip). Example pattern: `components/ui/button.tsx` uses `cva` + `cn`.
- Utilities: `lib/utils.ts` (`cn` wrapper around `clsx` + `tailwind-merge`).

If you edit code
- Keep changes small and follow existing patterns. Update the `package.json` scripts only if necessary. When adding server-side fetches, follow the error-to-result pattern used in `action-signin.ts`.

Feedback
- If anything in these instructions is unclear or missing, tell me which areas you want expanded (e.g. more examples from `components/`, deeper Docker guidance, or CI/PR guidance).
